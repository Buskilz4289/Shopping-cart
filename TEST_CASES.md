# בדיקות USE CASE - רשימת קניות

## USE CASE 1: הוספת מוצר חדש לרשימה
**תרחיש:** משתמש מוסיף מוצר חדש לרשימת הקניות

### שלבים:
1. משתמש מזין שם מוצר, כמות וקטגוריה בטופס
2. לוחץ על "הוסף"
3. המוצר מתווסף לרשימת הקניות
4. המוצר מתווסף אוטומטית ל"מוצרים שהוספתי" (גלובלי)

### תוצאה צפויה:
- ✅ המוצר מופיע ברשימת הקניות
- ✅ המוצר מופיע ב"מוצרים שהוספתי"
- ✅ המוצר נשמר ב-Firestore (אם זמין)
- ✅ כל המשתמשים רואים את המוצר ב"מוצרים שהוספתי"

### בדיקות:
- [ ] מוצר חדש מתווסף לרשימה
- [ ] מוצר חדש מתווסף ל"מוצרים שהוספתי"
- [ ] מוצר נשמר ב-Firestore
- [ ] מוצר מופיע אצל משתמשים אחרים

---

## USE CASE 2: יצירת רשימה חדשה
**תרחיש:** משתמש יוצר רשימת קניות חדשה

### שלבים:
1. משתמש לוחץ על "רשימה חדשה"
2. מאשר את יצירת הרשימה החדשה
3. הרשימה הנוכחית נשמרת להיסטוריה
4. רשימה חדשה ריקה נוצרת

### תוצאה צפויה:
- ✅ הרשימה הנוכחית נשמרת להיסטוריה
- ✅ רשימה חדשה ריקה נוצרת
- ✅ "מוצרים שהוספתי" נשארים (לא מתאפסים)
- ✅ כל המוצרים ב"מוצרים שהוספתי" עדיין גלויים

### בדיקות:
- [ ] רשימה חדשה נוצרת
- [ ] הרשימה הקודמת נשמרת בהיסטוריה
- [ ] "מוצרים שהוספתי" לא מתאפסים
- [ ] כל המוצרים ב"מוצרים שהוספתי" עדיין קיימים

---

## USE CASE 3: הוספת מוצר מ"מוצרים שהוספתי" לרשימה
**תרחיש:** משתמש מוסיף מוצר מהרשימה הגלובלית לרשימת הקניות שלו

### שלבים:
1. משתמש עובר לטאב "מוצרים שהוספתי"
2. לוחץ על כפתור "הוסף" ליד מוצר
3. המוצר מתווסף לרשימת הקניות

### תוצאה צפויה:
- ✅ המוצר מתווסף לרשימת הקניות
- ✅ אם המוצר כבר קיים - מוצגת הודעה
- ✅ המוצר לא מתווסף כפול

### בדיקות:
- [ ] מוצר מתווסף לרשימה
- [ ] הודעה מוצגת אם המוצר כבר קיים
- [ ] אין כפילויות ברשימה

---

## USE CASE 4: מחיקת מוצר מ"מוצרים שהוספתי"
**תרחיש:** משתמש מוחק מוצר מהרשימה הגלובלית

### שלבים:
1. משתמש עובר לטאב "מוצרים שהוספתי"
2. לוחץ על כפתור "מחק" ליד מוצר
3. מאשר את המחיקה
4. המוצר נמחק

### תוצאה צפויה:
- ✅ המוצר נמחק מ"מוצרים שהוספתי"
- ✅ המוצר נמחק מ-Firestore
- ✅ המוצר נעלם אצל כל המשתמשים
- ✅ המוצר לא נמחק מרשימות קניות קיימות

### בדיקות:
- [ ] מוצר נמחק מ"מוצרים שהוספתי"
- [ ] מוצר נמחק מ-Firestore
- [ ] מוצר נעלם אצל משתמשים אחרים
- [ ] מוצר לא נמחק מרשימות קניות

---

## USE CASE 5: סנכרון גלובלי - משתמשים מרובים
**תרחיש:** שני משתמשים משתמשים באפליקציה בו-זמנית

### שלבים:
1. משתמש א' מוסיף מוצר לרשימה
2. משתמש ב' בודק את "מוצרים שהוספתי"

### תוצאה צפויה:
- ✅ משתמש ב' רואה את המוצר שהוסיף משתמש א'
- ✅ עדכון בזמן אמת (ללא רענון)
- ✅ כל המשתמשים רואים את אותם מוצרים

### בדיקות:
- [ ] מוצר מופיע אצל כל המשתמשים
- [ ] עדכון בזמן אמת
- [ ] אין צורך ברענון

---

## USE CASE 6: Fallback ל-localStorage
**תרחיש:** משתמש משתמש באפליקציה ללא Firestore

### שלבים:
1. משתמש מוסיף מוצר לרשימה (ללא Firestore)
2. משתמש בודק את "מוצרים שהוספתי"

### תוצאה צפויה:
- ✅ המוצר מתווסף לרשימה
- ✅ המוצר מתווסף ל"מוצרים שהוספתי" (localStorage)
- ✅ המוצר נשמר ב-localStorage
- ✅ האפליקציה עובדת גם ללא Firestore

### בדיקות:
- [ ] מוצר מתווסף לרשימה
- [ ] מוצר מתווסף ל"מוצרים שהוספתי" (localStorage)
- [ ] מוצר נשמר ב-localStorage
- [ ] אין שגיאות בקונסול

---

## USE CASE 7: מוצר כפול - הוספה מחדש
**תרחיש:** משתמש מנסה להוסיף מוצר שכבר קיים ב"מוצרים שהוספתי"

### שלבים:
1. משתמש מוסיף מוצר "חלב" לרשימה
2. משתמש מוסיף שוב מוצר "חלב" לרשימה

### תוצאה צפויה:
- ✅ המוצר מתווסף לרשימה (אם אין כפילות ברשימה)
- ✅ המוצר לא מתווסף שוב ל"מוצרים שהוספתי"
- ✅ אין כפילויות ב"מוצרים שהוספתי"

### בדיקות:
- [ ] מוצר לא מתווסף כפול ל"מוצרים שהוספתי"
- [ ] אין כפילויות
- [ ] המוצר מופיע פעם אחת בלבד

---

## סיכום בעיות שנמצאו:

### בעיה 1: מוצר לא מתווסף ל"מוצרים שהוספתי"
**תיאור:** כשמוסיפים מוצר לרשימה, הוא לא תמיד מתווסף ל"מוצרים שהוספתי"

**סיבה אפשרית:**
- ההאזנה לא מעדכנת את ה-array המקומי מספיק מהר
- המוצר כבר קיים ב-Firestore אבל לא ב-array המקומי

**תיקון:**
- הוספתי לוגים לדיבוג
- הוספתי בדיקה אם המוצר כבר קיים ב-array לפני הוספה
- הוספתי setTimeout לעדכון התצוגה

### בעיה 2: סנכרון בין Firestore ל-array המקומי
**תיאור:** יש פער בין מה שנשמר ב-Firestore למה שמוצג ב-UI

**תיקון:**
- שיפרתי את ההאזנה לעדכונים מ-Firestore
- הוספתי בדיקה אם יש שינוי לפני עדכון ה-array
- הוספתי עדכון ידני של התצוגה אחרי הוספת מוצר

---

## המלצות לבדיקה ידנית:

1. **פתח את הקונסול (F12)** ובדוק את הלוגים:
   - "מוצר נוסף ל-addedProducts" - כשמוסיפים מוצר
   - "עדכון מוצרים שהוספתי מ-Firestore" - כשההאזנה מעדכנת

2. **בדוק את Firestore Console:**
   - עבור ל-collection `addedProducts`
   - ודא שמוצרים נשמרים שם

3. **בדוק סנכרון:**
   - פתח שני חלונות דפדפן
   - הוסף מוצר באחד
   - בדוק אם הוא מופיע בשני

4. **בדוק יצירת רשימה חדשה:**
   - הוסף כמה מוצרים
   - צור רשימה חדשה
   - ודא ש"מוצרים שהוספתי" לא מתאפסים
